<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport"
			content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
		<title>Sagimara</title>

		<!-- <link rel="stylesheet" type="text/css" media="screen"
			href="stylesheets/base.css"> -->
		<link rel="stylesheet" type="text/css" media="screen"
			href="stylesheets/test_main.css">

		<script type="text/javascript">

		var swiper;
		var swiperItem = [];
		var touchX;
		var startTouchX;
		var startPercent;
		var itemIndex = 0;
		var screenX = window.innerWidth;
		var validLength = screenX/5;

		var timer;
		var touches = [];

		function init() {
			swiper = document.getElementById('detail-info');
			swiperItem = [
				document.getElementById("location-info"),
				document.getElementById("watch-info"),
				document.getElementById("caution-info")
			];

			for(var i in swiperItem) {
				swiperItem[i].style.left = 100*i+"%";
			}
			//timer = setInterval(update, 15);

			swiper.addEventListener('touchend', function() {
				for(var i in swiperItem) {
					console.log("bef : "+swiperItem[i].style.left);
					var leftValue = parseFloat(swiperItem[i].style.left);
					if(swipeCheck(touchX, startTouchX) > 0)
					{
						leftValue = Math.floor(leftValue/100)*100;
						console.log("right");
					}
					else if(swipeCheck(touchX, startTouchX) < 0)
					{
						leftValue = Math.ceil(leftValue/100)*100;
						console.log("left");
					}
					else
					{
						leftValue = Math.round(leftValue/100)*100;
						console.log("not move");
					}
					//-webkit-transition: left 1s; -transition: left 1s;
					swiperItem[i].style.Transition = 'left 0.5s';
					swiperItem[i].style.WebkitTransition = 'left 0.5s';
					swiperItem[i].style.left = leftValue + "%";
		  			console.log("aft : "+swiperItem[i].style.left);
		  		}
				
				//else
			});

			swiper.addEventListener('touchmove', function(event) {

			  event.preventDefault();
			  touchX = event.touches[0].pageX;
			  var movePercent = (touchX-startTouchX)/screenX*100+startPercent;
			  if(movePercent <= 0 && movePercent >= -100*(swiperItem.length-1)) {
			  	for(var i in swiperItem) {
			  		swiperItem[i].style.Transition = 'left 0s';
					swiperItem[i].style.WebkitTransition = 'left 0s';
			  		swiperItem[i].style.left = (movePercent+i*100) + "%";
			  	}
			  	console.log(movePercent);
			  }
			});

			swiper.addEventListener('touchstart', function(event) {
			  event.preventDefault();
			  startTouchX = event.touches[0].pageX;
			  startPercent = parseInt(swiperItem[0].style.left);
			});
		};

		function swipeCheck(touchPos, startPos) {
			if(touchPos-startPos > validLength) { // right swipe action
				return -1;
			}
			else if(startPos-touchPos > validLength) { // left swipe action
				return 1;
			}
			else return 0;
		}

		</script>
	</head>
<body onload="init()" style="overflow:hidden;">	
	<section id="detail-info" class="clearfix">
		<section id="location-info">
			<p>최근<br>위치정보</p>
			<figure>
				<div id="map-canvas">
					<p>성남 분당구</p>
				</div>
			</figure>
		</section>
		<section id="watch-info">
			<p>지켜보는<br>사람의 수</p>
			<figure>
				<div id="watch-tool">
					<p>2</p>
				</div>
			</figure>
		</section>
		<section id="caution-info">
			<p>신고/주의<br>현황</p>
			<figure>
				<div id="caution-tool">
					<p>3</p>
				</div>
			</figure>
		</section>
	</section>
</body>
</html>